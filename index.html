<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice Betting App</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-red-500-rgb: 192, 21, 47;
            --color-success-rgb: 33, 128, 141;
            --color-error-rgb: 192, 21, 47;
            
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
            
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-weight-medium: 500;
            --font-weight-semibold: 550;
            --font-weight-bold: 600;
            
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            
            --radius-base: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04);
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-success-rgb: var(--color-teal-300-rgb);
                --color-error-rgb: 255, 84, 89;
            }
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            padding: var(--space-16);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-24);
            padding-bottom: var(--space-16);
            border-bottom: 1px solid var(--color-border);
        }
        
        h1 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }
        
        .bankroll {
            text-align: right;
        }
        
        .bankroll-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            display: block;
        }
        
        .bankroll-amount {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-primary);
        }
        
        .tabs {
            display: flex;
            gap: var(--space-8);
            margin-bottom: var(--space-20);
            border-bottom: 1px solid var(--color-border);
        }
        
        .tab {
            padding: var(--space-12) var(--space-16);
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--color-text-secondary);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: var(--space-24);
            color: var(--color-text-secondary);
        }
        
        .error {
            background-color: rgba(var(--color-error-rgb), 0.1);
            color: var(--color-error);
            padding: var(--space-12);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-16);
            font-size: var(--font-size-sm);
        }
        
        .sport-selector {
            display: flex;
            gap: var(--space-8);
            margin-bottom: var(--space-20);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: var(--space-8);
        }
        
        .sport-btn {
            padding: var(--space-8) var(--space-16);
            background: var(--color-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            color: var(--color-text);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .sport-btn.active {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
            border-color: var(--color-primary);
        }
        
        .game-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-16);
            margin-bottom: var(--space-16);
            box-shadow: var(--shadow-sm);
        }
        
        .game-time {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
        }
        
        .teams {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
            margin-bottom: var(--space-12);
        }
        
        .team-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .team-name {
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-lg);
        }
        
        .odds-container {
            display: flex;
            gap: var(--space-8);
        }
        
        .odds-btn {
            padding: var(--space-8) var(--space-16);
            background: var(--color-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            color: var(--color-text);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all 0.2s;
            min-width: 65px;
        }
        
        .odds-btn:hover {
            background: var(--color-secondary-hover);
        }
        
        .odds-btn.selected {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
            border-color: var(--color-primary);
        }
        
        .bet-slip {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--color-surface);
            border-top: 1px solid var(--color-border);
            padding: var(--space-16);
            box-shadow: var(--shadow-md);
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        
        .bet-slip.active {
            transform: translateY(0);
        }
        
        .bet-slip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-12);
        }
        
        .bet-slip-title {
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-lg);
        }
        
        .close-slip {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            font-size: 20px;
            cursor: pointer;
        }
        
        .bet-details {
            margin-bottom: var(--space-12);
            padding: var(--space-12);
            background: var(--color-secondary);
            border-radius: var(--radius-base);
        }
        
        .bet-info {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }
        
        .bet-selection {
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-base);
        }
        
        .stake-input-group {
            margin-bottom: var(--space-12);
        }
        
        .stake-input-group label {
            display: block;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--space-8);
        }
        
        .stake-input {
            width: 100%;
            padding: var(--space-12);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            color: var(--color-text);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
        }
        
        .potential-win {
            display: flex;
            justify-content: space-between;
            padding: var(--space-12);
            background: rgba(var(--color-success-rgb), 0.1);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-12);
        }
        
        .potential-win-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }
        
        .potential-win-amount {
            font-weight: var(--font-weight-bold);
            color: var(--color-success);
        }
        
        .place-bet-btn {
            width: 100%;
            padding: var(--space-16);
            background: var(--color-primary);
            border: none;
            border-radius: var(--radius-base);
            color: var(--color-btn-primary-text);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            cursor: pointer;
        }
        
        .place-bet-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .bet-history-item {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-16);
            margin-bottom: var(--space-12);
        }
        
        .bet-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-8);
        }
        
        .bet-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
        }
        
        .bet-status.pending {
            background: rgba(var(--color-slate-500-rgb), 0.15);
            color: var(--color-text-secondary);
        }
        
        .bet-status.won {
            background: rgba(var(--color-success-rgb), 0.15);
            color: var(--color-success);
        }
        
        .bet-status.lost {
            background: rgba(var(--color-error-rgb), 0.15);
            color: var(--color-error);
        }
        
        .settle-buttons {
            display: flex;
            gap: var(--space-8);
            margin-top: var(--space-8);
        }
        
        .settle-btn {
            padding: var(--space-6) var(--space-12);
            border: none;
            border-radius: var(--radius-base);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .settle-btn.win {
            background: var(--color-success);
            color: var(--color-btn-primary-text);
        }
        
        .settle-btn.lose {
            background: var(--color-error);
            color: var(--color-btn-primary-text);
        }
        
        .settle-btn:hover {
            opacity: 0.9;
        }
        
        .bet-matchup {
            font-weight: var(--font-weight-semibold);
            margin-bottom: 4px;
        }
        
        .bet-pick {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-8);
        }
        
        .bet-amounts {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-sm);
        }
        
        .empty-state {
            text-align: center;
            padding: var(--space-24);
            color: var(--color-text-secondary);
        }
        
        .refresh-btn {
            padding: var(--space-8) var(--space-16);
            background: var(--color-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            color: var(--color-text);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            margin-bottom: var(--space-16);
        }
        
        .api-info {
            background: rgba(var(--color-teal-500-rgb), 0.1);
            padding: var(--space-12);
            border-radius: var(--radius-base);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-16);
        }
        
        .api-info a {
            color: var(--color-primary);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎲 Practice Bets</h1>
            <div class="bankroll">
                <span class="bankroll-label">Bankroll</span>
                <span class="bankroll-amount" id="bankroll">$10,000</span>
            </div>
        </div>
        
        <div class="stats-container" id="stats-container" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-12); margin-bottom: var(--space-20); padding: var(--space-16); background: var(--color-surface); border: 1px solid var(--color-card-border); border-radius: var(--radius-lg);">
            <div class="stat-item" style="text-align: center;">
                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: 4px;">Win Rate</div>
                <div id="win-rate" style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-success);">0%</div>
            </div>
            <div class="stat-item" style="text-align: center;">
                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: 4px;">Record</div>
                <div id="record" style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-text);">0-0</div>
            </div>
            <div class="stat-item" style="text-align: center;">
                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: 4px;">Profit/Loss</div>
                <div id="profit-loss" style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold);">$0</div>
            </div>
        </div>
        
        <div class="api-info">
            ⚠️ This app requires a valid API key from The Odds API to display live betting lines. Get a free API key at <a href="https://the-odds-api.com" target="_blank" rel="noopener noreferrer">the-odds-api.com</a> (500 free requests/month). No demo data available.
        </div>
        
        <div class="form-group" style="margin-bottom: var(--space-20);">
            <label for="api-key-input" style="display: block; font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); margin-bottom: var(--space-8);">API Key (Optional)</label>
            <div style="display: flex; gap: var(--space-8);">
                <input type="text" id="api-key-input" placeholder="Enter your API key for live odds" style="flex: 1; padding: var(--space-12); background: var(--color-surface); border: 1px solid var(--color-border); border-radius: var(--radius-base); color: var(--color-text); font-size: var(--font-size-base);">
                <button id="save-api-key-btn" class="sport-btn" style="white-space: nowrap;">Save Key</button>
            </div>
            <div id="api-key-status" style="font-size: var(--font-size-sm); margin-top: var(--space-8); color: var(--color-text-secondary);"></div>
        </div>
        
        <div class="tabs">
            <button class="tab active" data-tab="games">Games</button>
            <button class="tab" data-tab="history">Bet History</button>
            <button class="tab" data-tab="settings">Settings</button>
        </div>
        
        <div id="games-tab" class="tab-content active">
            <div class="sport-selector" id="sport-selector"></div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-16);">
                <div style="display: flex; gap: var(--space-8);">
                    <button class="refresh-btn" id="refresh-btn">🔄 Refresh Odds</button>
                    <button class="refresh-btn" id="debug-btn">🔍 Debug Info</button>
                </div>
                <div style="font-size: var(--font-size-sm); color: var(--color-text-secondary);">
                    Showing games for next 7 days
                </div>
            </div>
            <div id="games-container"></div>
        </div>
        
        <div id="history-tab" class="tab-content">
            <div id="history-container"></div>
        </div>
        
        <div id="settings-tab" class="tab-content">
            <div style="background: var(--color-surface); border: 1px solid var(--color-card-border); border-radius: var(--radius-lg); padding: var(--space-16); margin-bottom: var(--space-16);">
                <h3 style="margin-bottom: var(--space-12); color: var(--color-text);">Data Storage</h3>
                <div id="storage-status" style="margin-bottom: var(--space-16); padding: var(--space-12); background: var(--color-secondary); border-radius: var(--radius-base); font-size: var(--font-size-sm);">
                    📱 Using local storage only - data doesn't sync between devices
                </div>
                <div style="margin-bottom: var(--space-16);">
                    <h4 style="margin-bottom: var(--space-8); color: var(--color-text);">Device ID</h4>
                    <div style="font-family: monospace; background: var(--color-secondary); padding: var(--space-8); border-radius: var(--radius-base); font-size: var(--font-size-sm);" id="device-id">
                        Not set
                    </div>
                </div>
                <div style="display: flex; gap: var(--space-8); flex-wrap: wrap;">
                    <button class="sport-btn" onclick="exportData()">📤 Export Data</button>
                    <button class="sport-btn" onclick="importData()">📥 Import Data</button>
                    <button class="sport-btn" onclick="resetAllData()" style="background: var(--color-error); color: white;">🗑️ Reset All</button>
                </div>
            </div>
            
            <div style="background: var(--color-surface); border: 1px solid var(--color-card-border); border-radius: var(--radius-lg); padding: var(--space-16);">
                <h3 style="margin-bottom: var(--space-12); color: var(--color-text);">Statistics</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-12); font-size: var(--font-size-sm);">
                    <div>Total Bets: <span id="total-bets">0</span></div>
                    <div>Pending Bets: <span id="pending-bets">0</span></div>
                    <div>Starting Bankroll: $1,000</div>
                    <div>Current Bankroll: <span id="current-bankroll-stats">$1,000</span></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="bet-slip" id="bet-slip">
        <div class="bet-slip-header">
            <span class="bet-slip-title">Place Bet</span>
            <button class="close-slip" id="close-slip">✕</button>
        </div>
        <div class="bet-details" id="bet-details"></div>
        <div class="stake-input-group">
            <label for="stake-input">Stake Amount</label>
            <input type="number" id="stake-input" class="stake-input" placeholder="100" min="1" step="1">
        </div>
        <div class="potential-win">
            <span class="potential-win-label">Potential Win</span>
            <span class="potential-win-amount" id="potential-win">$0.00</span>
        </div>
        <button class="place-bet-btn" id="place-bet-btn">Place Bet</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
    <script>
        // Firebase configuration (you'll need to set this up)
        const firebaseConfig = {
            // We'll add your Firebase config here after setup
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };
        
        // Initialize Firebase (only if config is provided)
        let db = null;
        let deviceId = null;
        
        if (firebaseConfig.apiKey) {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            
            // Generate or get device ID for syncing
            deviceId = localStorage.getItem('deviceId') || 'device_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('deviceId', deviceId);
        }
        
        // App State
        let state = {
            bankroll: 1000,
            currentBet: null,
            betHistory: [],
            games: [],
            currentSport: 'americanfootball_nfl',
            apiKey: '' // Users can add their own API key
        };
        
        // Sports configuration
        const SPORTS = [
            { key: 'americanfootball_nfl', name: 'NFL' },
            { key: 'basketball_nba', name: 'NBA' },
            { key: 'icehockey_nhl', name: 'NHL' },
            { key: 'baseball_mlb', name: 'MLB' },
            { key: 'soccer_epl', name: 'EPL' },
            { key: 'basketball_ncaab', name: 'NCAAB' },
            { key: 'americanfootball_ncaaf', name: 'NCAAF' }
        ];
        

        
        // Load state from memory or cloud
        async function loadState() {
            try {
                // Try to load from cloud first (if Firebase is configured)
                if (db && deviceId) {
                    try {
                        const doc = await db.collection('betting_data').doc(deviceId).get();
                        if (doc.exists) {
                            const cloudData = doc.data();
                            state = { ...state, ...cloudData };
                            updateBankrollDisplay();
                            renderBetHistory();
                            updateApiKeyDisplay();
                            console.log('✅ Data loaded from cloud');
                            return;
                        }
                    } catch (error) {
                        console.warn('Cloud load failed, trying local storage:', error);
                    }
                }
                
                // Fallback to local storage
                const saved = localStorage.getItem('bettingAppState');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    state = { ...state, ...parsed };
                    updateBankrollDisplay();
                    renderBetHistory();
                    updateApiKeyDisplay();
                    console.log('📱 Data loaded from local storage');
                }
            } catch (e) {
                // Fallback to sessionStorage
                try {
                    const saved = sessionStorage.getItem('bettingAppState');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        state = { ...state, ...parsed };
                        updateBankrollDisplay();
                        renderBetHistory();
                        updateApiKeyDisplay();
                    }
                } catch (e2) {
                    console.warn('No storage available, using default state');
                }
            }
        }
        
        // Save state to memory and cloud
        async function saveState() {
            try {
                // Save to local storage first (immediate)
                localStorage.setItem('bettingAppState', JSON.stringify(state));
                
                // Save to cloud (if configured)
                if (db && deviceId) {
                    try {
                        await db.collection('betting_data').doc(deviceId).set(state);
                        console.log('☁️ Data synced to cloud');
                    } catch (error) {
                        console.warn('Cloud save failed:', error);
                    }
                }
            } catch (e) {
                // Fallback to sessionStorage
                try {
                    sessionStorage.setItem('bettingAppState', JSON.stringify(state));
                } catch (e2) {
                    console.warn('No storage available');
                }
            }
        }
        
        // Update API key display
        function updateApiKeyDisplay() {
            const input = document.getElementById('api-key-input');
            const status = document.getElementById('api-key-status');
            if (input) {
                input.value = state.apiKey;
                if (state.apiKey) {
                    status.textContent = '✓ API key saved - using live odds';
                    status.style.color = 'var(--color-success)';
                } else {
                    status.textContent = 'Enter API key to view live games';
                    status.style.color = 'var(--color-text-secondary)';
                }
            }
        }
        
        // Save API key
        function saveApiKey() {
            const input = document.getElementById('api-key-input');
            state.apiKey = input.value.trim();
            saveState();
            updateApiKeyDisplay();
            if (state.apiKey) {
                fetchGames();
            }
        }
        
        // Initialize
        loadState();
        renderSportSelector();
        fetchGames();
        
        // API key button handler
        document.getElementById('save-api-key-btn').addEventListener('click', saveApiKey);
        document.getElementById('api-key-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') saveApiKey();
        });
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.dataset.tab;
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                // Update storage status when settings tab is opened
                if (tabName === 'settings') {
                    updateStorageStatus();
                }
            });
        });
        
        // Render sport selector
        function renderSportSelector() {
            const container = document.getElementById('sport-selector');
            container.innerHTML = SPORTS.map(sport => `
                <button class="sport-btn ${sport.key === state.currentSport ? 'active' : ''}" 
                        data-sport="${sport.key}">${sport.name}</button>
            `).join('');
            
            container.querySelectorAll('.sport-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.currentSport = btn.dataset.sport;
                    renderSportSelector();
                    fetchGames();
                });
            });
        }
        

        // Fetch games from API or use demo data
        async function fetchGames() {
            const container = document.getElementById('games-container');
            container.innerHTML = '<div class="loading">Loading games...</div>';
            
            try {
                if (state.apiKey) {
                    console.log('Fetching games for sport:', state.currentSport);
                    
                    // Use a CORS proxy for mobile/file access
                    const apiUrl = `https://api.the-odds-api.com/v4/sports/${state.currentSport}/odds/?apiKey=${state.apiKey}&regions=us&markets=h2h&oddsFormat=american`;
                    const corsProxy = 'https://api.allorigins.win/get?url=';
                    const url = corsProxy + encodeURIComponent(apiUrl);
                    
                    const response = await fetch(url, { timeout: 10000 });
                    
                    console.log('API Response status:', response.status);
                    
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('API Error details:', errorText);
                        throw new Error(`API Error: ${response.status} - ${errorText}`);
                    }
                    
                    const proxyData = await response.json();
                    const data = JSON.parse(proxyData.contents);
                    
                    console.log('Raw API data:', data);
                    console.log('Number of games received:', data.length);
                    
                    // Validate API response structure
                    if (!Array.isArray(data)) {
                        throw new Error('Invalid API response format');
                    }
                    
                    // Filter for games in the next 7 days and log the filtering
                    const now = new Date();
                    const sevenDaysLater = new Date(now.getTime() + (7 * 24 * 60 * 60 * 1000));
                    
                    console.log('Filtering games between:', now.toISOString(), 'and', sevenDaysLater.toISOString());
                    
                    state.games = data
                        .filter(game => {
                            const gameTime = new Date(game.commence_time);
                            const isInRange = gameTime >= now && gameTime <= sevenDaysLater;
                            console.log(`Game: ${game.away_team} vs ${game.home_team}, Time: ${game.commence_time}, In Range: ${isInRange}`);
                            return isInRange;
                        })
                        .sort((a, b) => new Date(a.commence_time) - new Date(b.commence_time));
                    
                    console.log('Filtered games count:', state.games.length);
                } else {
                    // No API key provided - show no games
                    console.log('No API key provided');
                    state.games = [];
                }
                
                renderGames();
            } catch (error) {
                console.error('Fetch error:', error);
                container.innerHTML = `
                    <div class="error">
                        Error loading games: ${error.message}. Please check your API key and try again.
                    </div>`;
                state.games = [];
                renderGames();
            }
        }
        
        // Render games
        function renderGames() {
            const container = document.getElementById('games-container');
            
            if (state.games.length === 0) {
                if (!state.apiKey) {
                    container.innerHTML = '<div class="empty-state">Please enter your API key to view live games</div>';
                } else {
                    container.innerHTML = '<div class="empty-state">No games available for this sport in the next 7 days</div>';
                }
                return;
            }
            
            container.innerHTML = state.games.map(game => {
                const gameTime = new Date(game.commence_time).toLocaleString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });
                
                const h2hMarket = game.bookmakers?.[0]?.markets?.find(m => m.key === 'h2h');
                const outcomes = h2hMarket?.outcomes || [];
                const awayOdds = outcomes.find(o => o.name === game.away_team)?.price || 'N/A';
                const homeOdds = outcomes.find(o => o.name === game.home_team)?.price || 'N/A';
                
                return `
                    <div class="game-card">
                        <div class="game-time">${gameTime}</div>
                        <div class="teams">
                            <div class="team-row">
                                <span class="team-name">${game.away_team}</span>
                                <div class="odds-container">
                                    <button class="odds-btn" 
                                            data-game-id="${game.id}"
                                            data-team="${game.away_team}"
                                            data-odds="${awayOdds}"
                                            data-opponent="${game.home_team}"
                                            data-time="${game.commence_time}">
                                        ${formatOdds(awayOdds)}
                                    </button>
                                </div>
                            </div>
                            <div class="team-row">
                                <span class="team-name">${game.home_team}</span>
                                <div class="odds-container">
                                    <button class="odds-btn"
                                            data-game-id="${game.id}"
                                            data-team="${game.home_team}"
                                            data-odds="${homeOdds}"
                                            data-opponent="${game.away_team}"
                                            data-time="${game.commence_time}">
                                        ${formatOdds(homeOdds)}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add click handlers to odds buttons
            container.querySelectorAll('.odds-btn').forEach(btn => {
                btn.addEventListener('click', () => selectBet(btn));
            });
        }
        
        // Format odds
        function formatOdds(odds) {
            if (odds === 'N/A') return 'N/A';
            const num = parseFloat(odds);
            return num > 0 ? `+${num}` : num.toString();
        }
        
        // Select bet
        function selectBet(btn) {
            const gameId = btn.dataset.gameId;
            const team = btn.dataset.team;
            const odds = parseFloat(btn.dataset.odds);
            const opponent = btn.dataset.opponent;
            const time = btn.dataset.time;
            
            state.currentBet = {
                gameId,
                team,
                opponent,
                odds,
                time
            };
            
            document.querySelectorAll('.odds-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            
            showBetSlip();
        }
        
        // Show bet slip
        function showBetSlip() {
            const betSlip = document.getElementById('bet-slip');
            const betDetails = document.getElementById('bet-details');
            const stakeInput = document.getElementById('stake-input');
            
            betDetails.innerHTML = `
                <div class="bet-info">${state.currentBet.team} vs ${state.currentBet.opponent}</div>
                <div class="bet-selection">${state.currentBet.team} ${formatOdds(state.currentBet.odds)}</div>
            `;
            
            betSlip.classList.add('active');
            stakeInput.value = '';
            updatePotentialWin();
            
            stakeInput.focus();
        }
        
        // Close bet slip
        document.getElementById('close-slip').addEventListener('click', () => {
            document.getElementById('bet-slip').classList.remove('active');
            document.querySelectorAll('.odds-btn').forEach(b => b.classList.remove('selected'));
            state.currentBet = null;
        });
        
        // Update potential win
        document.getElementById('stake-input').addEventListener('input', updatePotentialWin);
        
        function updatePotentialWin() {
            const stake = parseFloat(document.getElementById('stake-input').value) || 0;
            const odds = state.currentBet?.odds || 0;
            
            let potentialWin = 0;
            if (odds > 0) {
                potentialWin = stake * (odds / 100);
            } else {
                potentialWin = stake * (100 / Math.abs(odds));
            }
            
            document.getElementById('potential-win').textContent = `$${potentialWin.toFixed(2)}`;
            
            const placeBtn = document.getElementById('place-bet-btn');
            placeBtn.disabled = stake <= 0 || stake > state.bankroll;
        }
        
        // Add better stake validation
        function validateStake(stake) {
            const minBet = 1;
            const maxBet = Math.min(state.bankroll, 10000); // Cap at $10k or bankroll
            
            if (isNaN(stake) || stake < minBet) {
                return { valid: false, message: `Minimum bet is $${minBet}` };
            }
            
            if (stake > state.bankroll) {
                return { valid: false, message: 'Insufficient bankroll' };
            }
            
            if (stake > maxBet) {
                return { valid: false, message: `Maximum bet is $${maxBet}` };
            }
            
            return { valid: true };
        }
        
        // Replace alert with better confirmation
        function confirmBet(bet) {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.innerHTML = `
                    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                        <div style="background: var(--color-surface); padding: var(--space-24); border-radius: var(--radius-lg); max-width: 400px;">
                            <h3>Confirm Bet</h3>
                            <p>${bet.team} ${formatOdds(bet.odds)}</p>
                            <p>Stake: $${bet.stake}</p>
                            <p>To Win: $${bet.potentialWin.toFixed(2)}</p>
                            <div style="display: flex; gap: var(--space-12); margin-top: var(--space-16);">
                                <button class="settle-btn win" onclick="this.closest('div').parentElement.remove(); resolve(true)">Confirm</button>
                                <button class="settle-btn lose" onclick="this.closest('div').parentElement.remove(); resolve(false)">Cancel</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            });
        }
        
        // Place bet
        document.getElementById('place-bet-btn').addEventListener('click', () => {
            const stake = parseFloat(document.getElementById('stake-input').value);
            
            if (stake <= 0 || stake > state.bankroll) {
                alert('Invalid stake amount');
                return;
            }
            
            const odds = state.currentBet.odds;
            let potentialWin = 0;
            if (odds > 0) {
                potentialWin = stake * (odds / 100);
            } else {
                potentialWin = stake * (100 / Math.abs(odds));
            }
            
            const bet = {
                id: Date.now(),
                gameId: state.currentBet.gameId,
                team: state.currentBet.team,
                opponent: state.currentBet.opponent,
                odds: state.currentBet.odds,
                stake,
                potentialWin,
                status: 'pending',
                placedAt: new Date().toISOString(),
                gameTime: state.currentBet.time
            };
            
            confirmBet(bet).then(confirmed => {
                if (!confirmed) return;
                
                state.bankroll -= stake;
                state.betHistory.unshift(bet);
                
                updateBankrollDisplay();
                saveState();
                
                document.getElementById('bet-slip').classList.remove('active');
                document.querySelectorAll('.odds-btn').forEach(b => b.classList.remove('selected'));
                state.currentBet = null;
            });
        });
        
        // Update bankroll display
        function updateBankrollDisplay() {
            document.getElementById('bankroll').textContent = `$${state.bankroll.toLocaleString()}`;
            updateStats();
        }
        
        // Update statistics
        function updateStats() {
            const settledBets = state.betHistory.filter(b => b.status !== 'pending');
            const wins = settledBets.filter(b => b.status === 'won').length;
            const losses = settledBets.filter(b => b.status === 'lost').length;
            const totalBets = settledBets.length;
            
            const winRate = totalBets > 0 ? ((wins / totalBets) * 100).toFixed(1) : 0;
            
            // Calculate profit/loss
            const totalWinnings = state.betHistory
                .filter(b => b.status === 'won')
                .reduce((sum, bet) => sum + bet.potentialWin, 0);
            const totalLosses = state.betHistory
                .filter(b => b.status === 'lost')
                .reduce((sum, bet) => sum + bet.stake, 0);
            const profitLoss = totalWinnings - totalLosses;
            
            document.getElementById('win-rate').textContent = `${winRate}%`;
            document.getElementById('record').textContent = `${wins}-${losses}`;
            
            const profitLossEl = document.getElementById('profit-loss');
            profitLossEl.textContent = `${profitLoss >= 0 ? '+' : ''}$${profitLoss.toFixed(2)}`;
            profitLossEl.style.color = profitLoss >= 0 ? 'var(--color-success)' : 'var(--color-error)';
            
            // Update settings tab stats
            const totalBetsEl = document.getElementById('total-bets');
            const pendingBetsEl = document.getElementById('pending-bets');
            const currentBankrollEl = document.getElementById('current-bankroll-stats');
            
            if (totalBetsEl) totalBetsEl.textContent = state.betHistory.length;
            if (pendingBetsEl) pendingBetsEl.textContent = state.betHistory.filter(b => b.status === 'pending').length;
            if (currentBankrollEl) currentBankrollEl.textContent = `$${state.bankroll.toLocaleString()}`;
        }
        
        // Update storage status display
        function updateStorageStatus() {
            const statusEl = document.getElementById('storage-status');
            const deviceIdEl = document.getElementById('device-id');
            
            if (statusEl) {
                if (db && deviceId) {
                    statusEl.innerHTML = '☁️ Cloud sync enabled - data syncs across devices';
                    statusEl.style.background = 'rgba(var(--color-success-rgb), 0.1)';
                    statusEl.style.color = 'var(--color-success)';
                } else {
                    statusEl.innerHTML = '📱 Using local storage only - data doesn\'t sync between devices';
                    statusEl.style.background = 'var(--color-secondary)';
                    statusEl.style.color = 'var(--color-text-secondary)';
                }
            }
            
            if (deviceIdEl && deviceId) {
                deviceIdEl.textContent = deviceId;
            }
        }
        
        // Export data function
        function exportData() {
            const dataStr = JSON.stringify(state, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `betting-app-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        // Import data function
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            if (confirm('This will replace all your current data. Are you sure?')) {
                                state = { ...state, ...importedData };
                                saveState();
                                updateBankrollDisplay();
                                renderBetHistory();
                                updateApiKeyDisplay();
                                updateStorageStatus();
                                alert('Data imported successfully!');
                            }
                        } catch (error) {
                            alert('Error importing data: Invalid file format');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // Reset all data function
        function resetAllData() {
            if (confirm('This will delete ALL your betting data and reset your bankroll to $1,000. This cannot be undone. Are you sure?')) {
                if (confirm('Really sure? This will permanently delete your bet history, statistics, and reset everything.')) {
                    state = {
                        bankroll: 1000,
                        currentBet: null,
                        betHistory: [],
                        games: [],
                        currentSport: 'americanfootball_nfl',
                        apiKey: state.apiKey // Keep API key
                    };
                    saveState();
                    updateBankrollDisplay();
                    renderBetHistory();
                    updateStorageStatus();
                    alert('All data has been reset!');
                }
            }
        }
        
        // Render bet history
        function renderBetHistory() {
            const container = document.getElementById('history-container');
            
            if (state.betHistory.length === 0) {
                container.innerHTML = '<div class="empty-state">No bets placed yet</div>';
                return;
            }
            
            container.innerHTML = state.betHistory.map(bet => {
                const gameTime = new Date(bet.gameTime).toLocaleString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });
                
                return `
                    <div class="bet-history-item">
                        <div class="bet-header">
                            <div>
                                <div class="bet-matchup">${bet.team} vs ${bet.opponent}</div>
                                <div class="bet-pick">Pick: ${bet.team} ${formatOdds(bet.odds)} • ${gameTime}</div>
                            </div>
                            <span class="bet-status ${bet.status}">${bet.status.toUpperCase()}</span>
                        </div>
                        <div class="bet-amounts">
                            <span>Stake: $${bet.stake.toFixed(2)}</span>
                            <span>To Win: $${bet.potentialWin.toFixed(2)}</span>
                        </div>
                        ${bet.status === 'pending' ? `
                            <div class="settle-buttons">
                                <button class="settle-btn win" onclick="settleBet('${bet.id}', 'won')">Mark as Won</button>
                                <button class="settle-btn lose" onclick="settleBet('${bet.id}', 'lost')">Mark as Lost</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // Settle bet function
        function settleBet(betId, result) {
            const bet = state.betHistory.find(b => b.id == betId);
            if (!bet || bet.status !== 'pending') return;
            
            bet.status = result;
            
            if (result === 'won') {
                // Add winnings to bankroll (stake + potential win)
                state.bankroll += bet.stake + bet.potentialWin;
            }
            // If lost, stake was already deducted when bet was placed
            
            updateBankrollDisplay();
            renderBetHistory();
            saveState();
        }
        
        // Make settleBet globally accessible
        window.settleBet = settleBet;
        
        // Refresh button
        document.getElementById('refresh-btn').addEventListener('click', fetchGames);
        
        // Debug button
        document.getElementById('debug-btn').addEventListener('click', () => {
            console.log('=== DEBUG INFO ===');
            console.log('Current state:', state);
            console.log('API Key present:', !!state.apiKey);
            console.log('API Key length:', state.apiKey ? state.apiKey.length : 0);
            console.log('Current sport:', state.currentSport);
            console.log('Games array:', state.games);
            console.log('Games count:', state.games.length);
            
            if (state.apiKey) {
                // Test API call directly
                fetch(`https://api.the-odds-api.com/v4/sports/${state.currentSport}/odds/?apiKey=${state.apiKey}&regions=us&markets=h2h&oddsFormat=american`)
                    .then(response => {
                        console.log('Direct API test - Status:', response.status);
                        return response.json();
                    })
                    .then(data => {
                        console.log('Direct API test - Data:', data);
                        console.log('Direct API test - Count:', Array.isArray(data) ? data.length : 'Not an array');
                    })
                    .catch(error => {
                        console.error('Direct API test - Error:', error);
                    });
            }
            
            alert('Debug info logged to console. Check browser developer tools.');
        });
    </script>
</body>
</html>
